<!DOCTYPE html>
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
      <title>Mijndert Stuij - Grant an IAM user access to a specific S3 bucket and folder</title>
      <meta name="description" content="Consulting AWS engineer and proponent of simplicity with a focus on highly scalable cloud infrastructure" />
      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="/favicon.ico">
      <meta name="google-site-verification" content="saUIHjzun9dAGQ4-YTEb0W_vLiFRM1sEiHZXPCCOmyc" />
      <link rel="alternate" type="application/rss+xml" title="Mijndert Stuij" href="https://mijndertstuij.nl/feed.xml">
  </head>
  <body class="home-template">
      <header class="main-header post-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Grant an IAM user access to a specific S3 bucket and folder</h1>
            <p class="nav">
  <a href="/">Home</a>
  <a href="/about/">About</a>
  <a href="/uses/">Uses</a>
  <a href="/now/">Now</a>
  <a href="mailto:mijndert@mijndertstuij.nl">AMA</a>
</p>

        </div>
    </div>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <section class="post-meta">
                <time class="post-date" datetime="2015-02-13">13 Feb 2015</time>
                
            </section>
        </header>

        <section class="post-content">
            <p>In Amazon Web Services there’s a product called <a href="http://aws.amazon.com/iam/">IAM (Identity and Access Management)</a> which allows you to create users and groups and attach policies to both. In this how to we look at an IAM policy which allows a specific user to only have access to a specific <a href="http://aws.amazon.com/s3/">S3</a> bucket and folder.</p>

<!-- more -->

<p>The first thing you will need to do is grant the IAM user the rights to list all S3 buckets in the account. Because the user can only read/write to a specific bucket we hide every other bucket with a <em>condition</em> statement. In this case the user will only be able to see the bucket <em>mybucket</em>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
     </span><span class="s2">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::*"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"Condition"</span><span class="p">:{</span><span class="s2">"StringLike"</span><span class="p">:{</span><span class="s2">"s3:prefix"</span><span class="p">:[</span><span class="s2">"mybucket"</span><span class="p">]}}</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span></code></pre></div></div>

<p>The next step is to grant the IAM user rights to list all folders within the bucket and hide all other folders in which the user doesn’t have any rights. In this case the user will only see the folder <em>myfolder</em> in the bucket <em>mybucket</em>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowListingOfUserFolder"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"s3:ListBucket"</span><span class="p">],</span><span class="w">
      </span><span class="s2">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"arn:aws:s3:::mybucket"</span><span class="p">],</span><span class="w">
      </span><span class="s2">"Condition"</span><span class="p">:{</span><span class="s2">"StringLike"</span><span class="p">:{</span><span class="s2">"s3:prefix"</span><span class="p">:[</span><span class="s2">"myfolder/*"</span><span class="p">]}}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The final step is to grant rights to read and write in the specific folder. We also allow the user to <em>Get</em> and <em>Delete</em> versioned objects and list all objects in <em>myfolder</em>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="s2">"Effect"</span><span class="p">:</span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Action"</span><span class="p">:[</span><span class="w">
      </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"s3:PutObject"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"s3:GetObjectVersion"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"s3:DeleteObjectVersion"</span><span class="w">
   </span><span class="p">],</span><span class="w">
   </span><span class="s2">"Resource"</span><span class="p">:</span><span class="s2">"arn:aws:s3:::mybucket/myfolder/*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The final IAM policy:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"Version"</span><span class="p">:</span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Statement"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::*"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"Condition"</span><span class="p">:{</span><span class="s2">"StringLike"</span><span class="p">:{</span><span class="s2">"s3:prefix"</span><span class="p">:[</span><span class="s2">"mybucket"</span><span class="p">]}}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowListingOfUserFolder"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"s3:ListBucket"</span><span class="p">],</span><span class="w">
        </span><span class="s2">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"arn:aws:s3:::mybucket"</span><span class="p">],</span><span class="w">
        </span><span class="s2">"Condition"</span><span class="p">:{</span><span class="s2">"StringLike"</span><span class="p">:{</span><span class="s2">"s3:prefix"</span><span class="p">:[</span><span class="s2">"myfolder/*"</span><span class="p">]}}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"Effect"</span><span class="p">:</span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"Action"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"s3:PutObject"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"s3:GetObjectVersion"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"s3:DeleteObjectVersion"</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="s2">"Resource"</span><span class="p">:</span><span class="s2">"arn:aws:s3:::mybucket/myfolder/*"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

        </section>

    </article>

</main>

      <footer class="site-footer clearfix">
        <section class="copyright">
          <a href="/">Mijndert Stuij</a> &copy;
            2018 &bull; All rights reserved.
        </section>
        <section class="poweredby">
          Made with Jekyll using a modified <a href="http://github.com/rosario/kasper">Kasper theme</a>
        </section>
      </footer>
  </body>
  <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
</html>
