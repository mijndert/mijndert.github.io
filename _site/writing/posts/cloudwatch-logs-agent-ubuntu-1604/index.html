<!DOCTYPE html>
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
      <title>Mijndert Stuij - Installing the AWS Cloudwatch Logs Agent on Ubuntu 16.04</title>
      <meta name="description" content="Consulting AWS engineer and proponent of simplicity with a focus on highly scalable cloud infrastructure" />
      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="/favicon.ico">
      <meta name="google-site-verification" content="saUIHjzun9dAGQ4-YTEb0W_vLiFRM1sEiHZXPCCOmyc" />
      <link rel="alternate" type="application/rss+xml" title="Mijndert Stuij" href="https://mijndertstuij.nl/feed.xml">
  </head>
  <body class="home-template">
      <header class="main-header post-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Installing the AWS Cloudwatch Logs Agent on Ubuntu 16.04</h1>
            <p class="nav">
  <a href="/">Home</a>
  <a href="/about/">About</a>
  <a href="/uses/">Uses</a>
  <a href="/now/">Now</a>
  <a href="mailto:mijndert@mijndertstuij.nl">AMA</a>
</p>

        </div>
    </div>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <section class="post-meta">
                <time class="post-date" datetime="2016-06-22">22 Jun 2016</time>
                
            </section>
        </header>

        <section class="post-content">
            <p>Not only can <a href="https://aws.amazon.com/cloudwatch/">AWS Cloudwatch</a> alert you of problems with your resources, it can also store your log files and make them accesible in the AWS web interface. To make <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html">AWS Cloudwatch Logs</a> work you’ll need to install a small agent on your EC2 instances. Currently AWS has support for CentOS, RHEL, Amazon Linux and Ubuntu 12.04 and 14.04, among some other distributions.</p>

<p>The newest LTS version of Ubuntu, <a href="http://releases.ubuntu.com/16.04/">16.04</a>, isn’t on the list of supported versions yet. As Ubuntu switched to <a href="https://www.freedesktop.org/wiki/Software/systemd/">Systemd</a> for their default init system you’ll run into some trouble getting the Cloudwatch Logs Agent service started.</p>

<!-- more -->

<h3 id="installing-cloudwatch-logs-agent">Installing Cloudwatch Logs Agent</h3>

<p>Amazon provides a small installer for the agent.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python awslogs-agent-setup.py <span class="nt">-n</span> <span class="nt">-r</span> MY_REGION
</code></pre></div></div>

<p>Where MY_REGION is the region your EC2 instances are running in, for example eu-west-1.</p>

<h3 id="getting-the-service-to-run">Getting the service to run</h3>

<p>Because Amazon doesn’t provide support for Ubuntu 16.04 yet there also isn’t a Systemd unit file yet. I created one myself.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>The CloudWatch Logs agent
<span class="nv">After</span><span class="o">=</span>rc-local.service

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">Restart</span><span class="o">=</span>always
<span class="nv">KillMode</span><span class="o">=</span>process
<span class="nv">TimeoutSec</span><span class="o">=</span>infinity
<span class="nv">PIDFile</span><span class="o">=</span>/var/awslogs/state/awslogs.pid
<span class="nv">ExecStart</span><span class="o">=</span>/var/awslogs/bin/awslogs-agent-launcher.sh <span class="nt">--start</span> <span class="nt">--background</span> <span class="nt">--pidfile</span> <span class="nv">$PIDFILE</span> <span class="nt">--user</span> awslogs <span class="nt">--chuid</span> awslogs &amp;

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div></div>

<p>Make sure the service will start itself on boot and start the Agent.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>awslogs.service
systemctl start awslogs.service
</code></pre></div></div>

<h3 id="ansible">Ansible</h3>

<p>To make installing and configuring the agent just a little easier I made an Ansible role available that will do all of this for you. You can pull the code from <a href="https://github.com/mijndert/ansible-cloudwatch-logs-agent">the GitHub repository</a>. Of course improvements are welcome via a pull request.</p>

        </section>

    </article>

</main>

      <footer class="site-footer clearfix">
        <section class="copyright">
          <a href="/">Mijndert Stuij</a> &copy;
            2018 &bull; All rights reserved.
        </section>
        <section class="poweredby">
          Made with Jekyll using a modified <a href="http://github.com/rosario/kasper">Kasper theme</a>
        </section>
      </footer>
  </body>
  <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
</html>
